{% extends "base.html" %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <h2>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h2>
        <p class="welcome-text">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.username }}!</p>
    </div>

    <div class="dashboard-grid">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
        <div class="dashboard-sidebar">
            <div class="user-info-card">
                <h3>üë§ –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h3>
                <div class="user-details">
                    <div class="detail-item">
                        <span class="label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</span>
                        <span class="value">{{ user.username }}</span>
                    </div>

                    {% if user.email %}
                    <div class="detail-item">
                        <span class="label">Email:</span>
                        <span class="value">{{ user.email }}</span>
                    </div>
                    {% endif %}

                    <div class="detail-item">
                        <span class="label">–í—Å–µ–≥–æ —Ä–∞—Å—á–µ—Ç–æ–≤:</span>
                        <span class="value">{{ calculations|length }}</span>
                    </div>
                </div>

                <div class="logout-section">
                    <a href="{{ url_for('logout') }}" class="btn btn-warning">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</a>
                </div>
            </div>

            <div class="quick-actions">
                <h3>üìä –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                <a href="{{ url_for('calculate') }}" class="btn-action">
                    <span>üßÆ –ù–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç</span>
                </a>
                <a href="{{ url_for('history') }}" class="btn-action">
                    <span>üìã –ú–æ–∏ —Ä–∞—Å—á–µ—Ç—ã</span>
                </a>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–∞—Å—á–µ—Ç—ã -->
        <div class="dashboard-main">
            <div class="stats-section">
                <h3>üìà –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üìä</div>
                        <div class="stat-content">
                            <span class="stat-label">–í—Å–µ–≥–æ —Ä–∞—Å—á–µ—Ç–æ–≤</span>
                            <span class="stat-value">{{ calculations|length }}</span>
                        </div>
                    </div>

                    {% if calculations %}
                    {% set loss_count = calculations|selectattr('goal', 'equalto', 'loss')|list|length %}
                    {% set gain_count = calculations|selectattr('goal', 'equalto', 'gain')|list|length %}
                    {% set maint_count = calculations|selectattr('goal', 'equalto', 'maintenance')|list|length %}

                    <div class="stat-card">
                        <div class="stat-icon">‚¨áÔ∏è</div>
                        <div class="stat-content">
                            <span class="stat-label">–¶–µ–ª—å "–ü–æ—Ö—É–¥–µ–Ω–∏–µ"</span>
                            <span class="stat-value">{{ loss_count }}</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">‚¨ÜÔ∏è</div>
                        <div class="stat-content">
                            <span class="stat-label">–¶–µ–ª—å "–ù–∞–±–æ—Ä –º–∞—Å—Å—ã"</span>
                            <span class="stat-value">{{ gain_count }}</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">‚öñÔ∏è</div>
                        <div class="stat-content">
                            <span class="stat-label">–¶–µ–ª—å "–ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ"</span>
                            <span class="stat-value">{{ maint_count }}</span>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            {% if calculations %}
            <div class="recent-calculations">
                <div class="section-header">
                    <h3>üïê –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–∞—Å—á–µ—Ç—ã</h3>
                    <a href="{{ url_for('history') }}" class="view-all">–í—Å–µ —Ä–∞—Å—á–µ—Ç—ã ‚Üí</a>
                </div>

                <div class="calculations-list">
                    {% for calc in calculations[:5] %}
                    <div class="calculation-item">
                        <div class="calc-header">
                            <span class="calc-date">{{ calc.timestamp[:16] }}</span>
                            <span class="calc-goal {{ calc.goal }}">
                                {{ "–ü–æ—Ö—É–¥–µ–Ω–∏–µ" if calc.goal == 'loss' else "–ù–∞–±–æ—Ä –º–∞—Å—Å—ã" if calc.goal == 'gain' else "–ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ" }}
                            </span>
                        </div>
                        <div class="calc-details">
                            <div class="calc-detail">
                                <span class="label">–ö–∞–ª–æ—Ä–∏–∏:</span>
                                <span class="value">{{ calc.target_calories }}</span>
                            </div>
                            <div class="calc-detail">
                                <span class="label">–ë–ñ–£:</span>
                                <span class="value">{{ calc.protein_g }}–≥/{{ calc.fat_g }}–≥/{{ calc.carbs_g }}–≥</span>
                            </div>
                        </div>
                        <div class="calc-params">
                            <span class="param">–í–æ–∑—Ä–∞—Å—Ç: {{ calc.age }}</span>
                            <span class="param">–í–µ—Å: {{ calc.weight }}–∫–≥</span>
                            <span class="param">–†–æ—Å—Ç: {{ calc.height }}—Å–º</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-icon">üìã</div>
                <h3>–£ –≤–∞—Å –µ—â–µ –Ω–µ—Ç —Ä–∞—Å—á–µ—Ç–æ–≤</h3>
                <p>–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π —Ä–∞—Å—á–µ—Ç, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–¥–µ—Å—å</p>
                <a href="{{ url_for('calculate') }}" class="btn btn-primary">–°–¥–µ–ª–∞—Ç—å –ø–µ—Ä–≤—ã–π —Ä–∞—Å—á–µ—Ç</a>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}