{% extends "base.html" %}

{% block content %}
<div class="calculator-container">
    <h2>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫–∞–ª–æ—Ä–∏–π –∏ –ë–ñ–£</h2>

    {% if target_calories %}
    <div class="result-card">
        <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞</h3>

        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="user-info-section">
            <h4>–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ:</h4>
            <div class="result-grid">
                <div class="result-item">
                    <span class="label">–ü–æ–ª:</span>
                    <span class="value">{{ "–ú—É–∂—Å–∫–æ–π" if gender == "male" else "–ñ–µ–Ω—Å–∫–∏–π" }}</span>
                </div>
                <div class="result-item">
                    <span class="label">–í–æ–∑—Ä–∞—Å—Ç:</span>
                    <span class="value">{{ age }} –ª–µ—Ç</span>
                </div>
                <div class="result-item">
                    <span class="label">–í–µ—Å:</span>
                    <span class="value">{{ weight }} –∫–≥</span>
                </div>
                <div class="result-item">
                    <span class="label">–†–æ—Å—Ç:</span>
                    <span class="value">{{ height }} —Å–º</span>
                </div>
                <div class="result-item">
                    <span class="label">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:</span>
                    <span class="value">{{ activity }}</span>
                </div>
                <div class="result-item">
                    <span class="label">–¶–µ–ª—å:</span>
                    <span class="value goal-{{ goal_key }}">{{ goal }}</span>
                </div>
            </div>
        </div>

        <!-- –†–∞—Å—á–µ—Ç –∫–∞–ª–æ—Ä–∏–π -->
        <div class="calorie-results">
            <div class="calorie-card">
                <h4>BMR</h4>
                <p class="calorie-value">{{ bmr }}</p>
                <p class="calorie-desc">–ë–∞–∑–æ–≤—ã–π –º–µ—Ç–∞–±–æ–ª–∏–∑–º</p>
                <p class="calorie-info">–ö–∞–ª–æ—Ä–∏–∏ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ø–æ–∫–æ—è</p>
            </div>
            <div class="calorie-card">
                <h4>TDEE</h4>
                <p class="calorie-value">{{ tdee }}</p>
                <p class="calorie-desc">–û–±—â–∏–π —Ä–∞—Å—Ö–æ–¥</p>
                <p class="calorie-info">–° —É—á–µ—Ç–æ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</p>
            </div>
            <div class="calorie-card highlight">
                <h4>–¶–µ–ª–µ–≤—ã–µ –∫–∞–ª–æ—Ä–∏–∏</h4>
                <p class="calorie-value">{{ target_calories }}</p>
                <p class="calorie-desc">–î–Ω–µ–≤–Ω–∞—è –Ω–æ—Ä–º–∞</p>
                <p class="calorie-info">–î–ª—è —Ü–µ–ª–∏ "{{ goal }}"</p>
            </div>
        </div>

        <!-- –†–∞—Å—á–µ—Ç –ë–ñ–£ -->
        <div class="macros-section">
            <h3>ü•© –ù–æ—Ä–º–∞ –ë–ñ–£</h3>
            <p class="section-subtitle">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞–∫—Ä–æ–Ω—É—Ç—Ä–∏–µ–Ω—Ç–æ–≤</p>

            <div class="macros-grid">
                <div class="macro-card protein">
                    <div class="macro-header">
                        <h4>–ë–µ–ª–∫–∏</h4>
                        <span class="macro-percent">{{ macros.protein.percent }}%</span>
                    </div>
                    <div class="macro-values">
                        <div class="macro-value">
                            <span class="value">{{ macros.protein.grams }} –≥</span>
                            <span class="label">–≤ –¥–µ–Ω—å</span>
                        </div>
                        <div class="macro-value">
                            <span class="value">{{ macros.protein.calories|int }} –∫–∫–∞–ª</span>
                            <span class="label">—ç–Ω–µ—Ä–≥–∏—è</span>
                        </div>
                    </div>
                    <div class="macro-recommendation">
                        <strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong>
                        <p>{{ recommendations.protein }}</p>
                    </div>
                </div>

                <div class="macro-card fat">
                    <div class="macro-header">
                        <h4>–ñ–∏—Ä—ã</h4>
                        <span class="macro-percent">{{ macros.fat.percent }}%</span>
                    </div>
                    <div class="macro-values">
                        <div class="macro-value">
                            <span class="value">{{ macros.fat.grams }} –≥</span>
                            <span class="label">–≤ –¥–µ–Ω—å</span>
                        </div>
                        <div class="macro-value">
                            <span class="value">{{ macros.fat.calories|int }} –∫–∫–∞–ª</span>
                            <span class="label">—ç–Ω–µ—Ä–≥–∏—è</span>
                        </div>
                    </div>
                    <div class="macro-recommendation">
                        <strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong>
                        <p>{{ recommendations.fat }}</p>
                    </div>
                </div>

                <div class="macro-card carbs">
                    <div class="macro-header">
                        <h4>–£–≥–ª–µ–≤–æ–¥—ã</h4>
                        <span class="macro-percent">{{ macros.carbs.percent }}%</span>
                    </div>
                    <div class="macro-values">
                        <div class="macro-value">
                            <span class="value">{{ macros.carbs.grams }} –≥</span>
                            <span class="label">–≤ –¥–µ–Ω—å</span>
                        </div>
                        <div class="macro-value">
                            <span class="value">{{ macros.carbs.calories|int }} –∫–∫–∞–ª</span>
                            <span class="label">—ç–Ω–µ—Ä–≥–∏—è</span>
                        </div>
                    </div>
                    <div class="macro-recommendation">
                        <strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong>
                        <p>{{ recommendations.carbs }}</p>
                    </div>
                </div>
            </div>

            <!-- –ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ -->
            <div class="macros-total">
                <div class="total-item">
                    <span>–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–ª–æ—Ä–∏–π:</span>
                    <strong>{{ macros.total_calories|int }} –∫–∫–∞–ª/–¥–µ–Ω—å</strong>
                </div>
                <div class="total-item">
                    <span>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:</span>
                    <strong>–ë:{{ macros.protein.percent }}% –ñ:{{ macros.fat.percent }}% –£:{{ macros.carbs.percent }}%</strong>
                </div>
            </div>
        </div>

        <!-- –ü–∏—Ç–∞–Ω–∏–µ –ø–æ –ø—Ä–∏–µ–º–∞–º –ø–∏—â–∏ -->
        <div class="meal-plan-section">
            <h3>üçΩÔ∏è –ü—Ä–∏–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø—Ä–∏–µ–º–∞–º –ø–∏—â–∏</h3>
            <div class="meal-plan">
                <div class="meal-item">
                    <h4>–ó–∞–≤—Ç—Ä–∞–∫ (25%)</h4>
                    <p>{{ (target_calories * 0.25)|int }} –∫–∫–∞–ª</p>
                    <p>–ë–µ–ª–∫–∏: {{ (macros.protein.grams * 0.25)|round(1) }} –≥</p>
                </div>
                <div class="meal-item">
                    <h4>–û–±–µ–¥ (35%)</h4>
                    <p>{{ (target_calories * 0.35)|int }} –∫–∫–∞–ª</p>
                    <p>–ë–µ–ª–∫–∏: {{ (macros.protein.grams * 0.35)|round(1) }} –≥</p>
                </div>
                <div class="meal-item">
                    <h4>–£–∂–∏–Ω (25%)</h4>
                    <p>{{ (target_calories * 0.25)|int }} –∫–∫–∞–ª</p>
                    <p>–ë–µ–ª–∫–∏: {{ (macros.protein.grams * 0.25)|round(1) }} –≥</p>
                </div>
                <div class="meal-item">
                    <h4>–ü–µ—Ä–µ–∫—É—Å—ã (15%)</h4>
                    <p>{{ (target_calories * 0.15)|int }} –∫–∫–∞–ª</p>
                    <p>–ë–µ–ª–∫–∏: {{ (macros.protein.grams * 0.15)|round(1) }} –≥</p>
                </div>
            </div>
        </div>

        <div class="result-actions">
            <a href="{{ url_for('calculate') }}" class="btn btn-primary">–ù–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç</a>
            <a href="{{ url_for('history') }}" class="btn btn-secondary">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é</a>
        </div>
    </div>

    {% else %}
    <form method="POST" class="calculator-form">
        <div class="form-section">
            <h3>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <div class="form-row">
                <div class="form-group">
                    <label for="gender">–ü–æ–ª *</label>
                    <select id="gender" name="gender" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª</option>
                        <option value="male">–ú—É–∂—Å–∫–æ–π</option>
                        <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="age">–í–æ–∑—Ä–∞—Å—Ç (–ª–µ—Ç) *</label>
                    <input type="number" id="age" name="age" min="15" max="100" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="weight">–í–µ—Å (–∫–≥) *</label>
                    <input type="number" id="weight" name="weight" min="30" max="300" step="0.1" required>
                </div>

                <div class="form-group">
                    <label for="height">–†–æ—Å—Ç (—Å–º) *</label>
                    <input type="number" id="height" name="height" min="100" max="250" required>
                </div>
            </div>
        </div>

        <div class="form-section">
            <h3>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ —Ü–µ–ª—å</h3>
            <div class="form-group">
                <label for="activity">–£—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ *</label>
                <select id="activity" name="activity" required>
                    <option value="sedentary">–°–∏–¥—è—á–∏–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏ (–æ—Ñ–∏—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞, –º–∞–ª–æ –¥–≤–∏–∂–µ–Ω–∏—è)</option>
                    <option value="light">–õ–µ–≥–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (1-3 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –≤ –Ω–µ–¥–µ–ª—é)</option>
                    <option value="moderate">–£–º–µ—Ä–µ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (3-5 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≤ –Ω–µ–¥–µ–ª—é)</option>
                    <option value="active">–í—ã—Å–æ–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (6-7 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≤ –Ω–µ–¥–µ–ª—é)</option>
                    <option value="very_active">–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–ø–æ—Ä—Ç, —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="goal">–í–∞—à–∞ —Ü–µ–ª—å *</label>
                <select id="goal" name="goal" required>
                    <option value="loss">–ü–æ—Ö—É–¥–µ–Ω–∏–µ (—Å–æ–∑–¥–∞—Ç—å –¥–µ—Ñ–∏—Ü–∏—Ç –∫–∞–ª–æ—Ä–∏–π)</option>
                    <option value="maintenance">–ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –≤–µ—Å–∞</option>
                    <option value="gain">–ù–∞–±–æ—Ä –º—ã—à–µ—á–Ω–æ–π –º–∞—Å—Å—ã (–ø—Ä–æ—Ñ–∏—Ü–∏—Ç –∫–∞–ª–æ—Ä–∏–π)</option>
                </select>
            </div>
        </div>

        <div class="form-note">
            <p><strong>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong> –†–∞—Å—á–µ—Ç –ë–ñ–£ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ –≤–∞—à—É —Ü–µ–ª—å –∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.</p>
        </div>

        <button type="submit" class="btn btn-primary btn-large">
            –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∫–∞–ª–æ—Ä–∏–∏ –∏ –ë–ñ–£
        </button>
    </form>
    {% endif %}
</div>
{% endblock %}