{% extends "base.html" %}

{% block content %}
<div class="history-container">
    <h2>–ú–æ–∏ —Ä–∞—Å—á–µ—Ç—ã</h2>
    <p class="history-info">–ó–¥–µ—Å—å —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–∞—à–∏ —Ä–∞—Å—á–µ—Ç—ã</p>

    {% if calculations %}
    <div class="history-controls">
        <p>–í—Å–µ–≥–æ —Ä–∞—Å—á–µ—Ç–æ–≤: {{ calculations|length }}</p>
        <a href="{{ url_for('calculate') }}" class="btn btn-primary">–ù–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç</a>
    </div>

    <div class="history-list">
        {% for calc in calculations %}
        <div class="history-card">
            <div class="history-header">
                <h3>–†–∞—Å—á–µ—Ç –æ—Ç {{ calc['timestamp'] }}</h3>
                <div class="history-actions">
                    <span class="goal-badge {{ calc['goal'] }}">
                        {{ "–ü–æ—Ö—É–¥–µ–Ω–∏–µ" if calc['goal'] == 'loss' else "–ù–∞–±–æ—Ä –º–∞—Å—Å—ã" if calc['goal'] == 'gain' else "–ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ" }}
                    </span>
                    <form method="POST" action="{{ url_for('delete_calculation', calculation_id=calc.id) }}"
                          onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ä–∞—Å—á–µ—Ç?')">
                        <button type="submit" class="btn-delete">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </form>
                </div>
            </div>

            <div class="history-info">
                <div class="info-row">
                    <span>–ü–æ–ª/–í–æ–∑—Ä–∞—Å—Ç:</span>
                    <span>{{ "–ú—É–∂" if calc['gender'] == 'male' else "–ñ–µ–Ω" }}, {{ calc['age'] }} –ª–µ—Ç</span>
                </div>
                <div class="info-row">
                    <span>–í–µ—Å/–†–æ—Å—Ç:</span>
                    <span>{{ calc['weight'] }} –∫–≥ / {{ calc['height'] }} —Å–º</span>
                </div>
                <div class="info-row">
                    <span>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:</span>
                    <span>{{ "–°–∏–¥—è—á–∞—è" if calc['activity'] == 'sedentary' else "–õ–µ–≥–∫–∞—è" if calc['activity'] == 'light' else "–£–º–µ—Ä–µ–Ω–Ω–∞—è" if calc['activity'] == 'moderate' else "–í—ã—Å–æ–∫–∞—è" if calc['activity'] == 'active' else "–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è" }}</span>
                </div>
            </div>

            <div class="calorie-summary">
                <div class="summary-item">
                    <span>BMR:</span>
                    <strong>{{ calc['bmr'] }}</strong>
                </div>
                <div class="summary-item">
                    <span>TDEE:</span>
                    <strong>{{ calc['tdee'] }}</strong>
                </div>
                <div class="summary-item highlight">
                    <span>–¶–µ–ª–µ–≤—ã–µ:</span>
                    <strong>{{ calc['target_calories'] }}</strong>
                </div>
            </div>

            <div class="macros-summary">
                <h4>–ë–ñ–£:</h4>
                <div class="macros-bars">
                    <div class="macro-bar protein" style="width: {{ calc['protein_percent'] }}%">
                        <span>–ë: {{ calc['protein_g'] }}–≥ ({{ calc['protein_percent'] }}%)</span>
                    </div>
                    <div class="macro-bar fat" style="width: {{ calc['fat_percent'] }}%">
                        <span>–ñ: {{ calc['fat_g'] }}–≥ ({{ calc['fat_percent'] }}%)</span>
                    </div>
                    <div class="macro-bar carbs" style="width: {{ calc['carbs_percent'] }}%">
                        <span>–£: {{ calc['carbs_g'] }}–≥ ({{ calc['carbs_percent'] }}%)</span>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-history">
        <p>–£ –≤–∞—Å –µ—â–µ –Ω–µ—Ç —Ä–∞—Å—á–µ—Ç–æ–≤.</p>
        <a href="{{ url_for('calculate') }}" class="btn btn-primary">–°–¥–µ–ª–∞—Ç—å –ø–µ—Ä–≤—ã–π —Ä–∞—Å—á–µ—Ç</a>
    </div>
    {% endif %}
</div>
{% endblock %}